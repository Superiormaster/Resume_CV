<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Compose Resume</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="content">
        <header>
            <button class="menu-btn" id="openDrawer" aria-controls="mainDrawer" aria-expanded="false" aria-label="Open menu">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden>
                    <path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </button>
            <div style="flex:1">
                <strong style="color:#5b5b5b; border-radius:5px; padding:4px 6px;">Superior CV</strong>
            </div>
        </header>

        <div class="overlay" id="drawerOverlay" tabindex="-1" data-hidden="true"></div>

        <aside class="drawer" id="mainDrawer" role="dialog" aria-modal="true" aria-label="Main menu" aria-hidden="true">
            <div class="drawer__header">
                <div class="avatar" aria-hidden="true">‚åò</div>
                <div>
                    <div class="drawer__title">Superior CV</div>
                    <div class="drawer__subtitle">Professional CV</div>
                </div>
            </div>

            <div class="drawer-body">
                <div class="section-title">Settings</div>
                <ul class="nav-list" id="drawerNav">
                    <li><a href="#settings" data-action="settings"><span class="icon" aria-hidden>‚öôÔ∏è</span>Settings<span class="meta"> </span> </a></li>
                    <li><a href="#rate" data-action="rate"><span class="icon" aria-hidden>‚≠ê</span>Rate us</a></li>
                    <li><a href="#share" data-action="share"><span class="icon" aria-hidden>‚á™</span>Share</a></li>
                    <li><a href="#contact" data-action="contact"><span class="icon" aria-hidden>‚úâÔ∏è</span>Contact us</a></li>
                    <li><a href="#privacy" data-action="privacy"><span class="icon" aria-hidden>üîí</span>Privacy policy</a></li>
                    <li><a href="{{ url_for('logout') }}"><span class="icon" aria-hidden>‚Üê</span>Logout</a></li>
                </ul>

                <div class="dark" id="color-box">
                    <button id="toggle-btn">Dark Mode</button>
                </div>

                <div class="section-title">Premium</div>
                <div class="premium" style="align-items:center;">
                    <div class="crown" aria-hidden>üëë</div>
                    <div style="flex:1">
                        <div style="font-weight:700">Upgrade to Premium</div>
                        <div style="font-size:13px; color:#6b7280">Unlock our premium features</div>
                    </div>
                    <div>
                        <a href="#upgrade" style="display:inline-block; padding:8px 10px; border-radius:10px; background:linear-gradient(90deg,#d4af37,#f3d07a); font-weight:700; color:#082031">Get</a>
                    </div>
                </div>
            </div>
        </aside>

        <h2>Compose</h2>
        <div class="display">
            <div class="left">
                    <form action="{{ url_for('upload_file') }}" class="file" method="post" enctype="multipart/form-data">
                        <input type="file" class="file-input" name="file" required>
                        <button type="submit">Upload File</button>
                    </form>
            </div>

            <div class="left">
                <form method="post" id="resumeForm" action="{{ url_for('save') }}">
                    <label>Template
                        <select name="template" id="templateSelect">
                            {% for t in templates %}
                            <option value="{{ t }}">{{ t }}</option>
                            {% endfor %}
                        </select>
                    </label><br>
                    <label>Full name </label><input name="full_name" required><br>
                    <label>Title </label><input name="title"><br>
                    <label>Email </label><input name="email" type="email" required><br>
                    <label>Phone </label><input name="phone"><br>
                    <label>Website </label><input name="website"><br>
                    <label>LinkedIn </label><input name="linkedin" placeholder="https://..."><br>
                    <label>Summary  </label><textarea name="summary" rows="4"></textarea><br>
                    <label>Skills (comma separated) </label><input name="skills"><br>

                    <h4>Experience (up to 5)</h4>
                    {% for i in range(1,6) %}
                    <div class="exp">
                        <input name="exp_role_{{i}}" placeholder="Role">
                        <input name="exp_company_{{i}}" placeholder="Company">
                        <input name="exp_dates_{{i}}" placeholder="Dates">
                        <textarea name="exp_desc_{{i}}" placeholder="Description"></textarea>
                    </div>
                    {% endfor %}

                    <h4>Education (up to 3)</h4>
                    {% for i in range(1,4) %}
                    <div class="edu">
                        <input name="edu_degree_{{i}}" placeholder="Degree">
                        <input name="edu_school_{{i}}" placeholder="School">
                        <input name="edu_years_{{i}}" placeholder="Years">
                    </div>
                    {% endfor %}

                    <div class="btn-primary">
                        <button type="button" id="previewBtn">Live Preview</button>
                        <button type="submit">Save Resume</button>
                    </div>
                </form>
            </div>

            <div class="right">
                <h2>Live Preview</h2>
                <iframe id="previewFrame" style="width: 100%; height:800px; border:1px solid #ccc;"></iframe>
            </div>
        </div>
    </div>
        <script>
            let timeout;

               async function updatePreview() {
                   const form = document.getElementById('resumeForm');
                   const data = new FormData(form);

                   try{
                       const resp =await fetch("{{ url_for('preview') }}", {
                           method: "POST",
                           body: data
                       });

                       const j = await resp.json();
                       const iframe = document.getElementById('previewFrame');
                       iframe.srcdoc = j.html;
                   } catch (err) {
                       console.error("Preview error", err);
                   }
               }
               document.getElementById('previewBtn').addEventListener('click', updatePreview);
               document.getElementById('resumeForm').addEventListener('input', () => {
                   clearTimeout(timeout);
                   timeout = setTimeout(updatePreview, 600);
               });

               window.addEventListener('load', updatePreview);
        </script>
<script src="../static/slide.js"></script>
</body>
</html>